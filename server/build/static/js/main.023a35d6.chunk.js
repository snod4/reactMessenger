(this["webpackJsonptest-messenger"]=this["webpackJsonptest-messenger"]||[]).push([[0],{25:function(e,n,t){"use strict";t.r(n);var o=t(0),s=t(1),c=t(13),i=t.n(c),a=t(3),r=t(2);var l=t(5);var d=function(e){var n="message-header",t=n;return e.notify&&(t="message-header notify"),Object(o.jsx)("div",{className:t,onClick:function(){e.convoRef.newMessage=!1,e.selectConverstation(e.name,e.convoId,e.recipientId)},children:Object(o.jsxs)("div",{className:"row",children:[Object(o.jsx)("div",{className:"profilePic col-3",children:Object(o.jsx)("img",{src:e.image,alt:"profile picture"})}),Object(o.jsxs)("div",{className:"messageInfo col-8",children:[Object(o.jsx)("h3",{children:e.name}),Object(o.jsx)("p",{children:null!=e.content?null!=e.content.message?e.content.message.substr(0,30):"Sent a photo":"Send this person a message"})]}),Object(o.jsx)("div",{className:"message-header-options col-1",children:Object(o.jsxs)("div",{className:"align-self-center dropdown",children:[Object(o.jsx)("button",{className:"messeage-header-options-btn",type:"button",id:"dropdownMenuButton","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",children:"..."}),Object(o.jsxs)("div",{className:"dropdown-menu","aria-labelledby":"dropdownMenuButton",children:[Object(o.jsx)("a",{className:"dropdown-item",onClick:function(){fetch("/removeConvo",{method:"POST",body:JSON.stringify({convoId:e.convoId,recipientId:e.recipientId}),headers:{"Content-type":"application/json; charset=UTF-8"}}),e.removeFromConvoArr(e.convoRef)},children:"Remove"}),Object(o.jsx)("a",{className:"dropdown-item",href:"#",children:"Another action"}),Object(o.jsx)("a",{className:"dropdown-item",href:"#",children:"Something else here"})]})]})})]})})};var u=function(e){var n=Object(s.useState)(""),t=Object(r.a)(n,2),c=t[0],i=t[1],l=Object(s.useState)({show:!1,items:[]}),d=Object(r.a)(l,2),u=d[0],g=d[1];return Object(s.useEffect)((function(){""!==c?fetch("/userLookup",{method:"POST",body:JSON.stringify({name:c}),headers:{"Content-type":"application/json; charset=UTF-8"}}).then((function(e){return e.json()})).then((function(e){console.log(e),g({show:!0,items:e})})):g({show:!1,items:[]})}),[c]),Object(o.jsxs)("div",{className:"add-convo",children:[Object(o.jsx)("input",{onChange:function(e){var n=e.target.value;i(n)},onFocus:function(){return g((function(e){return{show:!0,items:e.items}}))},onBlur:function(){return g((function(e){return{show:!0,items:e.items}}))},type:"text",placeholder:"Name",value:c}),u.show?Object(o.jsx)("div",{className:"search-results",children:u.items.map((function(n,t){return Object(o.jsx)("div",{onClick:function(){g((function(e){return Object(a.a)(Object(a.a)({},e),{},{show:!1})})),console.log("Item.realName: ".concat(n.realName)),e.addToConvoArr({recipientName:n.realName,convoId:null,recipientId:n._id,recipientPhoto:"",notify:!1,mostRecentMessage:null})},children:n.realName})}))}):null]})};var g=function(e){return Object(o.jsx)("div",{className:"containter account-div",children:Object(o.jsxs)("div",{className:"row ",children:[Object(o.jsx)("div",{className:"account-name col-7 ",children:Object(o.jsx)("h3",{children:e.accountName})}),Object(o.jsxs)("div",{className:"account-options align-self-center col-5 dropdown  ",children:[Object(o.jsx)("button",{className:"btn shadow-none dropdown-toggle",type:"button",id:"dropdownMenuButton","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",children:"Options"}),Object(o.jsxs)("div",{className:"dropdown-menu","aria-labelledby":"dropdownMenuButton",children:[Object(o.jsx)("a",{className:"dropdown-item",onClick:e.logout,children:"Log out"}),Object(o.jsx)("a",{className:"dropdown-item",href:"#",children:"Another action"}),Object(o.jsx)("a",{className:"dropdown-item",href:"#",children:"Something else here"})]})]})]})})};var m=function(e){var n=Object(s.useState)(e.convoArr),t=Object(r.a)(n,2),c=t[0],i=t[1];function a(e){for(var n=0;n<c.length;n++)if(c[n].recipientId===e.recipientId){c.splice(n,1);break}i(Object(l.a)(c))}return console.log(c),console.log("ConvoArr"),console.log(c),Object(o.jsxs)("div",{className:"sidebar",children:[Object(o.jsx)(g,{accountName:e.name,logout:e.logout}),Object(o.jsx)(u,{addToConvoArr:function(e){for(var n=0;n<c.length;n++)if(c[n].recipientId===e.recipientId)return;i([].concat(Object(l.a)(c),[e]))}}),c.map((function(n,t){return Object(o.jsx)(d,{convoRef:n,notify:n.newMessage,convoId:n.convoId,recipientId:n.recipientId,selectConverstation:e.selectConverstation,image:n.img,name:n.recipientName,content:n.mostRecentMessage,removeFromConvoArr:a},t)}))]})},p=t(10),h=t.n(p),j=t(14),b=t(15),f=t(6),v=["image/jpg","image/gif","image/jpeg","image/png"];var O=function(e){var n=Object(s.useState)(""),t=Object(r.a)(n,2),c=t[0],i=t[1],a=Object(s.useState)([]),l=Object(r.a)(a,2),d=l[0],u=l[1],g=Object(s.useState)({display:"none"}),m=Object(r.a)(g,2),p=m[0],O=m[1];function x(n){console.log("Handle click");for(var t=document.querySelector(".preview");t.firstChild;)t.removeChild(t.firstChild);var o=document.querySelector(".file_input");o.value="",o.files=null,e.sendMessage(c,d),i(""),u([])}function w(){return(w=Object(b.a)(h.a.mark((function e(n){var t,o,s,c,i,a,r,l,d;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(console.log("handleImageSelection"),t=document.querySelector(".preview");t.firstChild;)t.removeChild(t.firstChild);o=document.createElement("ol"),t.appendChild(o),s=n.target.files,c=[],console.log("Length: ".concat(s.length)),i=Object(j.a)(s),e.prev=9,i.s();case 11:if((a=i.n()).done){e.next=22;break}return r=a.value,e.t0=c,e.next=16,Object(f.toBase64)(r);case 16:e.t1=e.sent,e.t0.push.call(e.t0,e.t1),l=document.createElement("li"),v.includes(r.type)&&(console.log("loop"),(d=document.createElement("img")).src=URL.createObjectURL(r),d.style.width="60px",l.appendChild(d),o.appendChild(l));case 20:e.next=11;break;case 22:e.next=27;break;case 24:e.prev=24,e.t2=e.catch(9),i.e(e.t2);case 27:return e.prev=27,i.f(),e.finish(27);case 30:u(c);case 31:case"end":return e.stop()}}),e,null,[[9,24,27,30]])})))).apply(this,arguments)}return Object(o.jsx)("div",{className:"messages",children:Object(o.jsxs)("div",{className:"input-group mb-3",children:[Object(o.jsx)("div",{className:"input-group-prepend",children:Object(o.jsxs)("span",{className:"input-group-text",children:["none"===p.display?Object(o.jsx)("div",{onClick:function(){O({display:"block"})},children:"+"}):"",Object(o.jsxs)("div",{style:p,children:[Object(o.jsx)("input",{className:"file_input",type:"file",multiple:"true",onChange:function(e){return w.apply(this,arguments)}}),Object(o.jsx)("div",{className:"preview"}),Object(o.jsx)("button",{onClick:function(){for(var e=document.querySelector(".preview");e.firstChild;)e.removeChild(e.firstChild);var n=document.querySelector(".file_input");n.value="",n.files=null,u([]),O({display:"none"})},type:"button",className:"btn btn-danger",children:"Cancel"})]})]})}),Object(o.jsx)("textarea",{type:"text",rows:"1",className:"form-control","aria-label":"Amount (to the nearest dollar)",onChange:function(e){i(e.target.value)},value:c,onKeyUp:function(e){console.log("Got to enter"),13===e.keyCode&&x()}}),Object(o.jsx)("div",{className:"input-group-append",children:Object(o.jsx)("span",{className:"input-group-text",onClick:x,children:"Send"})})]})})};var x=function(e){var n,t;return e.visible?(n="popup-visible",e.image.width>e.image.height?(t="popup-wide",console.log("Image width: ".concat(e.image.width,", Image height: ").concat(e.image.height))):(t="popup-tall",console.log("Image width: ".concat(e.image.width,", Image height: ").concat(e.image.height)))):n="popup-hidden",Object(o.jsx)("div",{className:n+" center",children:Object(o.jsx)("img",{className:t,src:null!==e.image?e.image.src:""})})};var w=function(e){var n="",t="",s="";return e.sent?(n="wrapper-r",t="message-text-r",s="message-image-r"):(n="wrapper-l",t="message-text-l",s="message-image-l"),Object(o.jsx)("div",{className:n,children:Object(o.jsxs)("div",{children:[0!=e.images.length?e.images.map((function(n){var t=Object(f.fromBase64)(n);return console.log("Rendering"),Object(o.jsx)("img",{onClick:function(n){console.log("Clicking Image"),n.stopPropagation(),e.showPopup({visible:!0,image:t})},className:s,src:t.src})})):null,0!=e.message.length?Object(o.jsx)("p",{className:t,children:e.message}):null]})})},N=t(8),I=t.n(N);var y=function(e){var n=e.ws,t=!1,c=new Audio("./notificationSound.mp3");c.addEventListener("canplaythrough",(function(e){t=!0}));var i=Object(s.useState)([]),a=Object(r.a)(i,2),d=a[0],u=a[1],g=Object(s.useState)({visible:!1,image:null}),m=Object(r.a)(g,2),p=m[0],h=m[1];function j(e){e.stopPropagation();var n=document.querySelector(".popup-visible");null!==n&&e.target!==n&&(console.log("Got to window click"),h({visible:!1,image:null}))}function b(){t&&c.play()}return Object(s.useEffect)((function(){console.log("popup useEffect"),p.visible?(console.log("Adding listner"),window.addEventListener("click",j)):(console.log("Removing event listener"),window.removeEventListener("click",j))}),[p,j]),Object(s.useEffect)((function(){console.log("Got use useEffect"),-1!==e.recipientId&&(console.log("Got to chat fetch, recipeintId: ".concat(e.recipientId,", name: ").concat(e.name)),fetch("/chat",{method:"POST",body:JSON.stringify({convoId:e.convoId,recipientId:e.recipientId,senderId:e.senderId,recipientName:e.name}),headers:{"Content-type":"application/json; charset=UTF-8"}}).then((function(e){return e.json()})).then((function(e){u(e.data)})))}),[e.convoId,e.name,e.recipientId,e.senderId]),n.onmessage=function(n){console.log("RECIEVED MESSAGE FROM SERVER"),console.log(n);var t=JSON.parse(n.data);console.log(t),t.senderId===e.recipientId?(b(),e.updateContent(t.senderId,null!==t.message&&0!==t.message.length?t.message:"Sent a photo",t.senderName,t.convoId,false),u([].concat(Object(l.a)(d),[{id:t.recipientId,message:t.message,images:t.images}]))):(b(),console.log("Hewre"),e.updateContent(t.senderId,null!==t.message&&0!==t.message.length?t.message:"Sent a photo",t.senderName,t.convoId,true))},console.log("messages:"),console.log(d),console.log(n),Object(o.jsxs)("div",{className:"messageWindow",children:[Object(o.jsx)(x,{visible:p.visible,image:p.image}),Object(o.jsx)("table",{className:"chatTable "+(p.visible?"hide":""),children:Object(o.jsxs)("tbody",{children:[Object(o.jsx)("tr",{className:"name-plate",children:Object(o.jsx)("td",{valign:"top",children:Object(o.jsx)("h1",{children:-1!==e.recipientId?e.name:"Pick someone"})})}),Object(o.jsx)("tr",{children:Object(o.jsx)("td",{valign:"middle",style:{height:"100%"},children:Object(o.jsx)("div",{className:"message-text-section",children:-1!==e.recipeintId?d.map((function(n,t){return Object(o.jsx)(w,{showPopup:h,message:n.message,images:n.images,sent:n.id===e.senderId},t)})):"Start Chatting Here"})})}),Object(o.jsx)("tr",{children:Object(o.jsx)("td",{valign:"bottom",children:-1!==e.recipientId?Object(o.jsx)(O,{sendMessage:function(t,o){""===t&&0==o.length||u((function(s){return s.push({id:e.senderId,message:t,images:o}),console.log("ChatView WS:"),console.log(n),n.send(JSON.stringify({recipientId:e.recipientId,message:t,images:o})),e.updateContent(e.recipientId,null!=t&&0!=t.length?t:"Sent a photo","",e.convoId,false),Object(l.a)(s)}))}}):null})})]})})]})};t(11).config();var C=function(e){var n=Object(s.useState)({register:!1,user:"",password:"",name:""}),t=Object(r.a)(n,2),c=t[0],i=t[1];return console.log("Register: "+c.register),Object(o.jsx)("div",{className:"text-center body-sign-in",children:Object(o.jsxs)("form",{className:"form-signin",children:[Object(o.jsx)("img",{className:"mb-4",src:"/docs/4.5/assets/brand/bootstrap-solid.svg",alt:"",width:"72",height:"72"}),Object(o.jsx)("h1",{className:"h3 mb-3 font-weight-normal",children:c.register?"Register":"Please Sign In"}),c.register?Object(o.jsxs)("div",{children:[Object(o.jsx)("label",{htmlFor:"inputName",className:"sr-only",children:"Name"}),Object(o.jsx)("input",{type:"text",id:"inputName",className:"form-control",placeholder:"Name",required:"",autoFocus:"",onChange:function(e){c.name=e.target.value,i((function(e){return Object(a.a)({},e)}))},value:c.name})]}):null,Object(o.jsx)("label",{htmlFor:"inputEmail",className:"sr-only",children:"Email address"}),Object(o.jsx)("input",{type:"email",id:"inputEmail",className:"form-control",placeholder:"Email address",required:"",autoFocus:"",onChange:function(e){c.user=e.target.value,i((function(e){return Object(a.a)({},e)}))},value:c.user}),Object(o.jsx)("label",{htmlFor:"inputPassword",className:"sr-only",children:"Password"}),Object(o.jsx)("input",{type:"password",id:"inputPassword",className:"form-control",placeholder:"Password",required:"",onChange:function(e){c.password=e.target.value,i((function(e){return Object(a.a)({},e)}))},value:c.password}),Object(o.jsx)("div",{className:"checkbox mb-3",children:Object(o.jsx)("label",{children:Object(o.jsx)("input",{type:"checkbox",value:"remember-me"})})}),Object(o.jsx)("button",{className:"btn btn-lg btn-primary btn-block",type:"submit",onClick:c.register?function(n){n.preventDefault(),fetch("/register",{method:"POST",body:JSON.stringify(c),headers:{"Content-type":"application/json; charset=UTF-8"}}).then((function(e){return e.json()})).then((function(n){console.log("Login:"),console.log(n),console.log("END"),n.convos.forEach((function(e){e.notify=!1})),e.handleLogin(n)}))}:function(n){n.preventDefault(),fetch("/login",{method:"POST",body:JSON.stringify(c),headers:{"Content-type":"application/json; charset=UTF-8"}}).then((function(e){return console.log(e),e.json()})).then((function(n){console.log("Login:"),console.log(n),console.log("END"),n.convos.forEach((function(e){e.notify=!1})),e.handleLogin(n)}))},children:c.register?"Register":"Sign In"}),c.register?null:Object(o.jsx)("button",{className:"btn btn-lg btn-primary btn-block",type:"submit",onClick:function(){i((function(e){return e.register=!0,Object(a.a)({},e)}))},children:"Register"}),Object(o.jsx)("p",{className:"mt-5 mb-3 text-muted",children:"\xa9 2017-2020"})]})})};t(11).config();var S=function(e){console.log("process.env.API_URL = ".concat(""));var n=Object(s.useState)(Object(a.a)({},e.loginResults)),t=Object(r.a)(n,2),c=t[0],i=t[1],l=Object(s.useState)((function(){if(c.isLoggedIn){var e=null;window.location.origin.includes("messenger-snodgras4")?e=window.location.origin.replace(/^https/,"wss"):window.location.origin.includes("localhost")&&(e="ws://localhost:3001"),console.log("WS URI: "+e);var n=new I.a(e);return n.onopen=function(){n.send(c.id),console.log("loginId: ".concat(c.id))},n}return null})),d=Object(r.a)(l,2),u=d[0],g=d[1],p=Object(s.useState)({name:"",convoId:-1,recipientId:-1}),h=Object(r.a)(p,2),j=h[0],b=h[1];if(null==u&&c.isLoggedIn){console.log("Connecting WebSocket");var f=null;window.location.origin.includes("messenger-snodgras4")?f=window.location.origin.replace(/^https/,"wss"):window.location.origin.includes("localhost")&&(f="ws://localhost:3001"),console.log("WS URI: "+f);var v=new I.a(f);v.onopen=function(){v.send(c.id),console.log("loginId: ".concat(c.id))},g(v)}if(c.isLoggedIn){return Object(o.jsxs)("div",{style:{height:"inherit"},children:[Object(o.jsx)(m,{selectConverstation:function(e,n,t){b({name:e,convoId:n,recipientId:t})},convoArr:c.convos,name:c.name,logout:function(){console.log("Logging out"),fetch("/logout",{method:"POST",body:JSON.stringify({id:c.id}),headers:{"Content-type":"application/json; charset=UTF-8"}}).then((function(e){u.close(1e3),g(null),i({isLoggedIn:!1})}))}}),Object(o.jsx)(y,{convoId:j.convoId,recipientId:j.recipientId,senderId:c.id,ws:u,name:j.name,updateContent:function(e,n,t,o,s){console.log("Update Content notify: ".concat(s)),i((function(c){for(var i=0;i<c.convos.length;i++)if(c.convos[i].recipientId===e)return c.convos[i].newMessage=s,c.convos[i].mostRecentMessage={id:e,message:n},Object(a.a)({},c);return c.convos.push({recipientId:e,convoId:o,recipientName:t,recipientPhoto:"",newMessage:s,mostRecentMessage:{id:e,message:n}}),Object(a.a)({},c)}))}})]})}return Object(o.jsx)(C,{handleLogin:function(e){console.log("Login Handler:"),console.log(e),i(Object(a.a)({},e))}})};console.log("In index.js testing"),console.log("process.env.PROXY_API = ".concat("/home")),fetch("/home").then((function(e){return console.log(e),e.json()})).then((function(e){console.log("index.js Login: ".concat(e.isLoggedIn)),i.a.render(Object(o.jsx)(S,{loginResults:e}),document.getElementById("root"))})).catch((function(e){return console.log(e)}))},6:function(e,n){e.exports={toBase64:function(e){return new Promise((function(n,t){var o=new FileReader;o.readAsDataURL(e),console.log("Converting"),o.onload=function(){return n(o.result)},o.onerror=function(e){return t(e)}}))},fromBase64:function(e){var n=new Image;return n.src=e,n}}}},[[25,1,2]]]);
//# sourceMappingURL=main.023a35d6.chunk.js.map